<!DOCTYPE html>
<html>
<head>
    <title>Бальный зал "Золотая Роза"</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        #map { height: 1500px; width: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
<script>
  // Конфигурация Firebase (замените на свои данные)
const firebaseConfig = {
  apiKey: "AIzaSyCYLz0HIs9P4xp9ILpErRmKmWr5Ljss31U",
  authDomain: "goldenroseweb.firebaseapp.com",
  projectId: "goldenroseweb",
  storageBucket: "goldenroseweb.firebasestorage.app",
  messagingSenderId: "355125234409",
  appId: "1:355125234409:web:5f08a1431d9525838d7e78",
  measurementId: "G-K9YD88LCNJ"
};
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // Инициализация карты
  const imageBounds = [[0, 0], [5000, 5000]];
  const map = L.map('map', {
    crs: L.CRS.Simple,
    minZoom: -2,
    maxZoom: 5
  });
  L.imageOverlay('https://i.imgur.com/OagxjJL.jpeg', imageBounds).addTo(map);
  map.fitBounds(imageBounds);

  // Загрузка маркеров из Firebase
  database.ref('markers').on('value', (snapshot) => {
    const markersData = snapshot.val();
    map.eachLayer(layer => {
      if (layer instanceof L.Marker) layer.remove();
    });
    
    for (const key in markersData) {
      createMarker(markersData[key], key);
    }
  });

  // Создание маркера с возможностью редактирования
  function createMarker(data, id) {
    const kingIcon = L.icon({
      iconUrl: 'https://i.imgur.com/fOvASpi.jpeg',
      iconSize: [40, 40],
      iconAnchor: [20, 40]
    });

    const marker = L.marker([data.x, data.y], {
      draggable: true,
      icon: kingIcon
    }).bindPopup(`
      <h3 contenteditable="true" class="editable">${data.title}</h3>
      <div contenteditable="true" class="editable">${data.content}</div>
      <button onclick="saveChanges('${id}')">Сохранить</button>
    `).addTo(map);

    // Сохранение позиции при перемещении
    marker.on('dragend', (e) => {
      database.ref(`markers/${id}`).update({
        x: e.target.getLatLng().x,
        y: e.target.getLatLng().y
      });
    });
  }

  // Сохранение текста
  window.saveChanges = function(id) {
    const popupContent = document.querySelector('.leaflet-popup-content');
    const title = popupContent.querySelector('h3').innerText;
    const content = popupContent.querySelector('div').innerText;
    
    database.ref(`markers/${id}`).update({ title, content });
  };

  // Добавление нового маркера (пример)
  map.on('click', (e) => {
    const newMarkerRef = database.ref('markers').push();
    newMarkerRef.set({
      x: e.latlng.x,
      y: e.latlng.y,
      title: 'Новый персонаж',
      content: 'Описание...'
    });
  });
</script>
</body>
</html>
